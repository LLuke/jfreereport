<!-- An ANT build file for JFreeReport -->

<!-- This file builds all misc modules except the reference documentation. -->

<project name="jfreereport" default="all" basedir="..">

  <target name="init">
    <dirname property="antfile.dir" file="${ant.file}"/>
    <ant antfile="${antfile.dir}/build-core.xml" target="init"/>
    <property file="${antfile.dir}/build.properties"/>
    <antcall target="rebuild-core"/>
  </target>

  <target name="check-core">
    <available file="${core-jar-file}" type="file" property="core-jar-file-present"/>
  </target>

  <target name="rebuild-core" unless="core-jar-file-present" depends="check-core" >
    <echo>
      Rebuilding core ...
    </echo>
    <dirname property="antfile.dir" file="${ant.file}"/>
    <ant antfile="${antfile.dir}/build-core.xml" target="all"/>
  </target>

  <!-- ************************************************************** -->
  <!--                                                                -->
  <!--  Bean shell modules                                            -->
  <!--                                                                -->
  <!--  Depends on: Core task                                         -->
  <!-- ************************************************************** -->

  <target name="init-module-misc-beanshell" depends="init" >
    <available file="${libdir}/${beanshell-jar-file}" type="file" property="beanshell-jar-file-present"/>
    <fail unless="beanshell-jar-file-present">
      The file ${libdir}/${beanshell-jar-file} was not found in the lib directory.
      This file is required to build the BeanShell module.
    </fail>

  </target>

  <target name="compile-module-misc-beanshell"
    depends="init-module-misc-beanshell">
    <description>
      Compiles the beanshell module classes of JFreeReport.
      This contains the BSHExpression. The task will fail, if the BSH
      jar is not found.
    </description>

    <!-- create a temp build directory -->
    <mkdir dir="build"/>

    <!-- compile the source -->
    <!-- We exclude all module implementations by default -->
    <javac srcdir="source"
      destdir="build" target="${build.target}"
      deprecation="${build.deprecation}" debug="${build.debug}" optimize="${build.optimize}">
      <include name="org/jfree/report/modules/misc/beanshell/*"/>
      <classpath>
        <pathelement location="${libdir}/${jcommon-jar-file}" />
        <pathelement location="${libdir}/${beanshell-jar-file}"/>
        <pathelement location="${core-jar-file}"/>
      </classpath>
    </javac>

    <antcall target="copy-resources-misc-beanshell" inheritAll="true"/>

    <!-- make the jar -->
    <jar jarfile="${module-misc-beanshell-file}"
         basedir="build">
      <manifest>
          <attribute name="Class-Path" value="${core-jar-file} ${manifest-lib-prefix}${beanshell-jar-file}"/>
      </manifest>
    </jar>

    <!-- delete the temp directory -->
    <delete dir="build" />
  </target>

  <target name="copy-resources-misc-beanshell">
    <copy file="source/org/jfree/report/modules/misc/beanshell/module.properties"
      tofile="build/org/jfree/report/modules/misc/beanshell/module.properties"/>

    <copy file="source/org/jfree/report/modules/misc/beanshell/BSHExpressionHeader.txt"
      tofile="build/org/jfree/report/modules/misc/beanshell/BSHExpressionHeader.txt"/>
  </target>


  <!-- ************************************************************** -->
  <!--                                                                -->
  <!--  Survey modules                                                -->
  <!--                                                                -->
  <!--  Depends on: Core task                                         -->
  <!-- ************************************************************** -->

  <target name="compile-module-misc-survey">
    <description>
      Compiles the survey module classes of JFreeReport.
    </description>

    <!-- create a temp build directory -->
    <mkdir dir="build"/>

    <!-- compile the source -->
    <!-- We exclude all module implementations by default -->
    <javac srcdir="source"
      destdir="build" target="${build.target}"
      deprecation="${build.deprecation}" debug="${build.debug}" optimize="${build.optimize}">
      <include name="org/jfree/report/modules/misc/survey/*"/>
      <classpath>
        <pathelement location="${libdir}/${jcommon-jar-file}" />
        <pathelement location="${core-jar-file}"/>

      </classpath>
    </javac>

    <antcall target="copy-resources-misc-survey" inheritAll="true"/>

    <!-- make the jar -->
    <jar jarfile="${module-misc-survey-file}"
         basedir="build">
      <manifest>
          <attribute name="Class-Path" value="${core-jar-file}"/>
      </manifest>
    </jar>

    <!-- delete the temp directory -->
    <delete dir="build" />
  </target>

  <target name="copy-resources-misc-survey">
    <copy file="source/org/jfree/report/modules/misc/survey/module.properties"
      tofile="build/org/jfree/report/modules/misc/survey/module.properties"/>
  </target>

  <!-- ************************************************************** -->
  <!--                                                                -->
  <!--  Tablemodel modules                                            -->
  <!--                                                                -->
  <!--  Depends on: core task                                         -->
  <!-- ************************************************************** -->

  <target name="compile-module-misc-tablemodel" depends="init">
    <description>
      Compiles the tablemodel module classes of JFreeReport.
      This contains support classes to make working with tablemodels
      more comfortable.
    </description>

    <!-- create a temp build directory -->
    <mkdir dir="build"/>

    <!-- compile the source -->
    <!-- We exclude all module implementations by default -->
    <javac srcdir="source"
      destdir="build" target="${build.target}"
      deprecation="${build.deprecation}" debug="${build.debug}" optimize="${build.optimize}">
      <include name="org/jfree/report/modules/misc/tablemodel/*"/>
      <classpath>
        <pathelement location="${libdir}/${jcommon-jar-file}" />
        <pathelement location="${core-jar-file}"/>
      </classpath>
    </javac>

    <antcall target="copy-resources-misc-tablemodel" inheritAll="true"/>

    <!-- make the jar -->
    <jar jarfile="${module-misc-tablemodel-file}"
         basedir="build">
      <manifest>
          <attribute name="Class-Path" value="${core-jar-file}"/>
      </manifest>
    </jar>

    <!-- delete the temp directory -->
    <delete dir="build" />
  </target>

  <target name="copy-resources-misc-tablemodel">
    <copy file="source/org/jfree/report/modules/misc/tablemodel/module.properties"
      tofile="build/org/jfree/report/modules/misc/tablemodel/module.properties"/>

    <copy file="source/org/jfree/report/modules/misc/tablemodel/configuration.properties"
      tofile="build/org/jfree/report/modules/misc/tablemodel/configuration.properties"/>
  </target>

  <!-- ************************************************************** -->
  <!--                                                                -->
  <!--  ConfigStore base modules                                      -->
  <!--                                                                -->
  <!--  Depends on: Core task                                         -->
  <!-- ************************************************************** -->

  <target name="compile-module-misc-configstore-base" depends="init">
    <description>
      Compiles the configstore-base module classes of JFreeReport.
      This contains base classes to store runtime configuration on the system.
    </description>

    <!-- create a temp build directory -->
    <mkdir dir="build"/>

    <!-- compile the source -->
    <!-- We exclude all module implementations by default -->
    <javac srcdir="source"
      destdir="build" target="${build.target}"
      deprecation="${build.deprecation}" debug="${build.debug}" optimize="${build.optimize}">
      <include name="org/jfree/report/modules/misc/configstore/base/*"/>
      <classpath>
        <pathelement location="${libdir}/${jcommon-jar-file}" />
        <pathelement location="${core-jar-file}"/>
      </classpath>
    </javac>

    <antcall target="copy-resources-misc-configstore-base" inheritAll="true"/>

    <!-- make the jar -->
    <jar jarfile="${module-misc-configstore-base-file}"
         basedir="build">
      <manifest>
          <attribute name="Class-Path" value="${core-jar-file}"/>
      </manifest>
    </jar>

    <!-- delete the temp directory -->
    <delete dir="build" />
  </target>

  <target name="copy-resources-misc-configstore-base">
    <copy file="source/org/jfree/report/modules/misc/configstore/base/module.properties"
      tofile="build/org/jfree/report/modules/misc/configstore/base/module.properties"/>
  </target>
  <!-- ************************************************************** -->
  <!--                                                                -->
  <!--  filesystem configstore modules                                -->
  <!--                                                                -->
  <!--  Depends on: configstore base                                  -->
  <!-- ************************************************************** -->

  <target name="compile-module-misc-configstore-filesystem" depends="init, compile-module-misc-configstore-base">
    <description>
      Compiles the configstore-filesystem module classes of JFreeReport.
      This contains classes to store runtime configuration on the filesystem of
      the host.
    </description>

    <!-- create a temp build directory -->
    <mkdir dir="build"/>

    <!-- compile the source -->
    <!-- We exclude all module implementations by default -->
    <javac srcdir="source"
      destdir="build" target="${build.target}"
      deprecation="${build.deprecation}" debug="${build.debug}" optimize="${build.optimize}">
      <include name="org/jfree/report/modules/misc/configstore/filesystem/*"/>
      <classpath>
        <pathelement location="${libdir}/${jcommon-jar-file}" />
        <pathelement location="${core-jar-file}"/>
        <pathelement location="${module-misc-configstore-base-file}"/>
      </classpath>
    </javac>

    <antcall target="copy-resources-misc-configstore-filesystem" inheritAll="true"/>

    <!-- make the jar -->
    <jar jarfile="${module-misc-configstore-filesystem-file}"
         basedir="build">
      <manifest>
          <attribute name="Class-Path" value="${core-jar-file} ${modules-misc-configstore-base-file}"/>
      </manifest>
    </jar>

    <!-- delete the temp directory -->
    <delete dir="build" />
  </target>

  <target name="copy-resources-misc-configstore-filesystem">
    <copy file="source/org/jfree/report/modules/misc/configstore/filesystem/module.properties"
      tofile="build/org/jfree/report/modules/misc/configstore/filesystem/module.properties"/>

    <copy file="source/org/jfree/report/modules/misc/configstore/filesystem/configuration.properties"
      tofile="build/org/jfree/report/modules/misc/configstore/filesystem/configuration.properties"/>
  </target>

  <!-- ************************************************************** -->
  <!--                                                                -->
  <!--  Config Store build Task                                       -->
  <!--                                                                -->
  <!--  Depends on: Core task                                         -->
  <!-- ************************************************************** -->

  <target name="compile-module-misc-configstore"
    depends="compile-module-misc-configstore-base,
    compile-module-misc-configstore-filesystem">
  </target>

  <!--
    This target is called from build-all
    -->
  <target name="copy-resources"
    depends="copy-resources-misc-configstore-base,
    copy-resources-misc-configstore-filesystem,
    copy-resources-misc-tablemodel,
    copy-resources-misc-beanshell,
    copy-resources-misc-survey" />

  <target name="compile"
    depends="compile-module-misc-beanshell,
    compile-module-misc-tablemodel,
    compile-module-misc-configstore,
    compile-module-misc-configstore-filesystem,
    compile-module-misc-survey"/>

  <target name="all" depends="init, compile"/>

</project>
